(function(){var p;p=angular.element;angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(r){return{restrict:"A",require:"ngModel",link:function(f,s,b,m){var a,c,g,n,d,t,q,k,l;c=r.get("$validator");a=r.get("$parse");n=a(b.ngModel);k=[];l=function(h,e){var a,c,d,g,t,l,q;null==e&&(e={});a=g=0;c=function(){var h,a,c;if(++g>=k.length){m.$setValidity(b.ngModel,!0);a=0;for(c=k.length;a<c;a++)h=k[a],h.success(n(f),f,s,b,r);"function"===typeof e.success&&
e.success()}};if(0===k.length)return c();t=function(h){return h.validator(n(f),f,s,b,{success:function(){return c()},error:function(){h.enableError&&1===++a&&(m.$setValidity(b.ngModel,!1),h.error(n(f),f,s,b,r));if(1===("function"===typeof e.error?e.error():void 0)){try{s[0].scrollIntoViewIfNeeded()}catch(c){}return s[0].select()}}})};l=0;for(q=k.length;l<q;l++){d=k[l];switch(h){case "blur":if("blur"!==d.invoke)continue;d.enableError=!0;break;case "watch":if("watch"!==d.invoke&&!d.enableError){c();
continue}break;case "broadcast":d.enableError=!0}t(d)}};t=function(){var h;h=c.getRule("required");null==h&&(h=c.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return k.push(h)};q=function(h){var e,a,c,d,g;g=[];e=a=0;for(c=k.length;a<c;e=a+=1)(null!=(d=k[e])?d.name:void 0)===h&&(k[e].success(n(f),f,s,b,r),k.splice(e,1),g.push(e--));return g};b.$observe("validator",function(h){var e,a,g,m;k.length=0;(d.validatorRequired||d.required)&&t();if(e=h.match(/^\/(.*)\/$/))a=c.convertRule("dynamic",
{validator:RegExp(e[1]),invoke:b.validatorInvoke,error:b.validatorError}),k.push(a);else if(e=h.match(/^\[(.+)\]$/)){h=e[1].split(",");m=[];e=0;for(g=h.length;e<g;e++)a=h[e],a=c.getRule(a.replace(/^\s+|\s+$/g,"")),"function"===typeof a.init&&a.init(f,s,b,r),a?m.push(k.push(a)):m.push(void 0);return m}});b.$observe("validatorError",function(a){var e;if(e=b.validator.match(/^\/(.*)\/$/))return q("dynamic"),a=c.convertRule("dynamic",{validator:RegExp(e[1]),invoke:b.validatorInvoke,error:a}),k.push(a)});
d={validatorRequired:!1,required:!1};b.$observe("validatorRequired",function(a){if(a&&"false"!==a)return t(),d.validatorRequired=!0;if(d.validatorRequired)return q("required"),d.validatorRequired=!1});b.$observe("required",function(a){if(a&&"false"!==a)return t(),d.required=!0;if(d.required)return q("required"),d.required=!1});g=function(h,e){var c,d;if(e){if(b.validatorGroup===e)return!0;if(h.targetScope===f)return 0===b.ngModel.indexOf(e);c=function(a,e){var b,h;for(b in a)switch(h=a[b],typeof h){case "string":if("$$hashKey"===
b&&h===e)return!0;break;case "object":if(c(h,e))return!0}return!1};d=b.ngModel.indexOf(".");d=0<=d?b.ngModel.substr(0,d):b.ngModel;d=a(d)(f);return c(a(e)(h.targetScope),d.$$hashKey)}return!0};f.$on(c.broadcastChannel.prepare,function(a,e){if(g(a,e.model))return e.accept()});f.$on(c.broadcastChannel.start,function(a,e){if(g(a,e.model))return l("broadcast",{success:e.success,error:e.error})});f.$on(c.broadcastChannel.reset,function(a,e){var c,d,l;if(g(a,e.model)){d=0;for(l=k.length;d<l;d++)c=k[d],
c.success(n(f),f,s,b,r),"watch"!==c.invoke&&(c.enableError=!1);return m.$setValidity(b.ngModel,!0)}});f.$watch(b.ngModel,function(a,e){if(a!==e)return l("watch",{oldValue:e})});return p(s).bind("blur",function(){return f.$root.$$phase?l("blur"):f.$apply(function(){return l("blur")})})}}}])}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var p;p=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var r,f,s;s=f=r=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(b){r=b;f=r.get("$q");return s=r.get("$timeout")};this.convertError=function(b){var m;if("function"===typeof b)return b;m=b.constructor===String?b:"";return function(a,b,g,n){var d,f,q;a=p(g).parent();for(b=[];0!==a.length;){if(a.hasClass("form-group")){a.addClass("has-error");
q=a.find("label");d=0;for(f=q.length;d<f;d++)g=q[d],p(g).hasClass("error")&&p(g).remove();g=p("<label class='control-label error'>"+m+"</label>");n.id&&g.attr("for",n.id);a.append(g);break}b.push(a=a.parent())}return b}};this.convertSuccess=function(b){return"function"===typeof b?b:function(b,a,c){var g,f;a=p(c).parent();for(b=[];0!==a.length;){if(a.hasClass("has-error")){a.removeClass("has-error");f=a.find("label");c=0;for(g=f.length;c<g;c++)a=f[c],p(a).hasClass("error")&&p(a).remove();break}b.push(a=
a.parent())}return b}};this.convertValidator=function(b){var m;m=function(){};b.constructor===RegExp?m=function(a,c,g,f,d){null==a&&(a="");return b.test(a)?"function"===typeof d.success?d.success():void 0:"function"===typeof d.error?d.error():void 0}:"function"===typeof b&&(m=function(a,c,g,m,d){return f.all([b(a,c,g,m,r)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof d.success?d.success():void 0:"function"===typeof d.error?d.error():void 0},function(){return"function"===typeof d.error?
d.error():void 0})});return m};this.convertRule=function(b){return function(f,a){var c,g,n;null==a&&(a={});c={name:f,enableError:"watch"===a.invoke,invoke:a.invoke,init:a.init,validator:null!=(g=a.validator)?g:function(){return!0},error:null!=(n=a.error)?n:"",success:a.success};c.error=b.convertError(c.error);c.success=b.convertSuccess(c.success);c.validator=b.convertValidator(c.validator);return c}}(this);this.register=function(b,f){null==f&&(f={});return this.rules[b]=this.convertRule(b,f)};this.getRule=
function(b){return this.rules[b]?angular.copy(this.rules[b]):null};this.validate=function(b){return function(m,a){var c,g,n,d,p,q,k,l;l=f.defer().promise;q=p=d=0;c=[];g=[];n=[];l.success=function(a){c.push(a);return l};l.error=function(a){g.push(a);return l};l.then=function(a){n.push(a);return l};k={model:a,accept:function(){return d++},success:function(){var a,e,b;if(++p===d){e=0;for(b=c.length;e<b;e++)a=c[e],a();e=0;for(b=n.length;e<b;e++)a=n[e],a()}return p},error:function(){var a,b,c;if(0===q++){b=
0;for(c=g.length;b<c;b++)a=g[b],a();b=0;for(c=n.length;b<c;b++)a=n[b],a()}return q}};m.$broadcast(b.broadcastChannel.prepare,k);s(function(){var a,b,f;if(0===d)for(b=0,f=c.length;b<f;b++)a=c[b],a();else return a=r.get("$validator"),m.$broadcast(a.broadcastChannel.start,k)});return l}}(this);this.reset=function(b){return function(f,a){return f.$broadcast(b.broadcastChannel.reset,{model:a})}}(this);this.get=function(b){this.setupProviders(b);return{rules:this.rules,broadcastChannel:this.broadcastChannel,
register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
